# ğŸ“ŒSingleton Pattern

> ì• í”Œë¦¬ìºì´ì…˜ì´ ë™ì‘í•˜ëŠ” ê³¼ì •ì—ì„œ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ì— ë‹¨ í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´
> 
- ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì—­ì— ì‚¬ìš©ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ë‹¤.
- ë¡œê·¸ ê¸°ë¡, ìºì‹±, ì‚¬ìš©ì ì„¤ì •, DB connection instance ë“±ë“±ì— ì‚¬ìš©ëœë‹¤.

## êµ¬í˜„ 1: ì˜ë„ì ì¸ êµ¬í˜„

- private ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ê³ , ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œë¥¼ public staticìœ¼ë¡œ ì§€ì •

```java
package com.singleton;

public class Singleton1 {
	private static Singleton1 instance;
	
	private Singleton1() {}
	
	public static Singleton1 getInstance() {
		if (instance == null ) {instance = new Singleton1();}
		return instance;
	}

}
```

```java
package com.main;

import com.singleton.Singleton1;

public class SingetonTest {

	public static void main(String[] args) {
		// TODO Auto-generated method stub
		Singleton1 instance1 = Singleton1.getInstance();
		Singleton1 instance2 = Singleton1.getInstance();
		
		System.out.println(instance1 == instance1); //true
		System.out.println(instance1.equals(instance2)); //tre

	}

}
```

**ë‹¨ì  â†’ ë™ì‹œì„± ë¬¸ì œ**

- ë‹¨ì  ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œëŠ” ì‹±ê¸€í†¤ì´ ë³´ì¥ë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.
    - ìŠ¤ë ˆë“œ 1ê³¼ ìŠ¤ë ˆë“œ 2ê°€ ë™ì‹œì— getInstance()ë¥¼ ì‹¤í–‰í•  ë•Œ, ë™ì‹œì— ì¡°ê±´ë¬¸ì„ í†µê³¼í•œë‹¤ë©´, ì„œë¡œ ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ê°€ ë§Œë“¤ì–´ì§€ê²Œ ë¨.

## êµ¬í˜„ 2: ë™ê¸°í™”

- ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œë¥¼ `public synchronized static`ìœ¼ë¡œ ì§€ì •

```java
package com.singleton;

public class Singleton1 {
	
	private static Singleton1 instance;
	
	private Singleton1() {}
	
	public synchronized static Singleton1 getInstance() {
		if (instance == null ) {instance = new Singleton1();}
		return instance;
	}

}
```

**ë‹¨ì  â†’ ë¦¬ì†ŒìŠ¤ ë‚­ë¹„**

- ë¦¬ì†ŒìŠ¤ë¥¼ ë‚­ë¹„í•˜ì§€ ì•Šê¸° ìœ„í•´ ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì‚¬ìš©í•˜ëŠ”ë°, ì˜¤íˆë ¤ ë¦¬ì†ŒìŠ¤ê°€ ë‚­ë¹„ë¨
    - getInstance()ë¥¼ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ lock ë°œìƒ â†’ ìŠ¤ë ˆë“œ ë‚­ë¹„!

## êµ¬í˜„ 3: Double Checked Locking

- ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œë¥¼ public synchronized staticìœ¼ë¡œ ì§€ì •
- ì¸ìŠ¤í„´ìŠ¤ë¥¼ private static volatile ìœ¼ë¡œ ìƒì„±

â†’ ì¸ìŠ¤í„´ìŠ¤ê°€ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´,  `synchronized (Singleton.class)` ë¸”ë¡ì´ ì‹¤í–‰ë˜ì§€ ì•Šì•„ ì¦‰ì‹œ ì¸ìŠ¤í„´ìŠ¤ë§Œ ë°˜í™˜í•  ìˆ˜ ìˆìŒ

- ìŠ¤ë ˆë“œ 1ì´ ë©”ì¸ë©”ëª¨ë¦¬ì— ê°’ì„ ì“°ê¸° ì „ì— ìŠ¤ë ˆë“œ 2ê°€ ë©”ì¸ ë©”ëª¨ë¦¬ë¡œë¶€í„° ê°’ì„ ì½ëŠ” ê³¼ì •ì—ì„œ ë¬¸ì œê°€ ë°œìƒ í•  ìˆ˜ ìˆëŠ”ë°, `volatile` í‚¤ì›Œë“œë¥¼ ì“°ë©´ ì´ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.

```java
package com.singleton;

public class Singleton {
	
	private static volatile Singleton instance;
	
	private Singleton() {}
	
	public synchronized static Singleton getInstance() {
		if (instance == null ) {
			synchronized (Singleton.class) { instance = new Singleton(); }
		}
		return instance;
	}

}
```

**ë‹¨ì  â†’ ê°œë°œìì˜ ê³  ìˆ˜ì¤€ì˜ ì´í•´ë„ ìš”êµ¬**

- volatile ì€ JDK 1.5 ì´ìƒì—ì„œë§Œ ì§€ì›í•œë‹¤.
- JVMì— ë”°ë¼ ìŠ¤ë ˆë“œì˜ ë™ì‹œì„± ë¬¸ì œë¥¼ ë³´ì¥í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.

## êµ¬í˜„ 4: Bill Pugh Solution (ê¶Œì¥)

- ì‹±ê¸€í†¤ êµ¬í˜„ ì‹œ ê¶Œì¥ë˜ëŠ” ë°©ë²•ìœ¼ë¡œ, `private static class Holder`ë¥¼ í™œìš”í•œ ë°©ë²•ì´ë‹¤.
- ë‚´ë¶€ì—ì„œ `synchronized` ê°€ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— `synchronized` ë¥¼ ëª…ì‹œí•˜ì§€ ì•Šì•„ë„ ëœë‹¤
- ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë  ë•Œ static í‚¤ì›Œë“œ ë•Œë¬¸ì— ë©”ëª¨ë¦¬ì— ì •ì  ì˜ì—­ì— ì˜¬ë¼ê°
    - lock ë°œìƒ ë¬¸ì œ (ìŠ¤ë ˆë“œ ë‚­ë¹„) ì™€ ë™ì‹œì„± ë¬¸ì œ ëª¨ë‘ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

```java
package com.singleton;

public class Singleton {
	
	private Singleton() {}
	
	private static class SingletonHolder {
		private static final Singleton SINGLETON = new Singleton();
	}
	
	public static Singleton getInstance() {
		return SingletonHolder.SINGLETON;
	}

}
```

**ë‹¨ì  â†’ ì„ì˜ë¡œ ì‹±ê¸€í†¤ íŒ¨í„´ì„ íŒŒê´´í•  ìˆ˜ ìˆìŒ**

- reflectionì„ í†µí•œ ì‹±ê¸€í†¤ íŒŒê´´
- serializarionì„ í†µí•œ ì‹±ê¸€í†¤ íŒŒê´´



## êµ¬í˜„ 5: Enum (ê¶Œì¥)

- enum í´ë˜ìŠ¤ë¥¼ í™œìš©í•œ ì‹±ê¸€í†¤ íŒ¨í„´ìœ¼ë¡œ êµ¬í˜„ì´ ë§¤ìš° í¸í•˜ë‹¤
- ìŠ¤ë ˆë“œ ë‚­ë¹„ ë³´ì¥ ê°€ëŠ¥

```java
package com.singleton;

public enum Singleton { INSTANCE; }
```

```java
package com.main;

import com.singleton.Singleton;

public class SingetonTest {

	public static void main(String[] args) {
		// TODO Auto-generated method stub
		Singleton instance1 = Singleton.INSTANCE;
		Singleton instance2 = Singleton.INSTANCE;
		
		System.out.println(instance1 == instance1);
		System.out.println(instance1.equals(instance2));

	}

}
```

**ë‹¨ì  â†’ ì‹±ê¸€í†¤ í•´ì œ ë¶ˆê°€**

- ì‹±ê¸€í„´ í•´ì œ ë²ˆê±°ë¡œì›€
- Enumì™¸ì˜ í´ë˜ìŠ¤ ìƒì† ë¶ˆê°€